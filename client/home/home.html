<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="home.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:ital,wght@0,400..700;1,400..700&family=Mingzat&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="../imagens/favicon.ico">
</head>
<body>
    <nav class="navbar navbar-expand-lg" style="background-color: #A5D4FB; padding: 0;">
        <div class="container-fluid d-flex justify-content-between">
            <a class="navbar-brand" href="#">
                <img src="../imagens/logo.png" alt="logomarca"
                     width="55" height="auto"
                     class="d-inline-block align-text-top"
                     style="padding-left: 10px;">
            </a>
            
        
            <form class="form-pesquisa" role="search">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-search"></i>
                    </span>
                    <input class="form-control" type="search" placeholder="procurar..." aria-label="Search">
                </div>
            </form>
            
           
            <div class="icons">
                <div class="icon-container">
                    <a href="../carteira/carteira.html" style="text-decoration: none; color: black;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="auto" fill="currentColor" class="bi bi-cash-coin" viewBox="0 0 16 16" >
                            <path fill-rule="evenodd" d="M11 15a4 4 0 1 0 0-8 4 4 0 0 0 0 8m5-4a5 5 0 1 1-10 0 5 5 0 0 1 10 0"/>
                            <path d="M9.438 11.944c.047.596.518 1.06 1.363 1.116v.44h.375v-.443c.875-.061 1.386-.529 1.386-1.207 0-.618-.39-.936-1.09-1.1l-.296-.07v-1.2c.376.043.614.248.671.532h.658c-.047-.575-.54-1.024-1.329-1.073V8.5h-.375v.45c-.747.073-1.255.522-1.255 1.158 0 .562.378.92 1.007 1.066l.248.061v1.272c-.384-.058-.639-.27-.696-.563h-.668zm1.36-1.354c-.369-.085-.569-.26-.569-.522 0-.294.216-.514.572-.578v1.1zm.432.746c.449.104.655.272.655.569 0 .339-.257.571-.709.614v-1.195z"/>
                            <path d="M1 0a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4.083q.088-.517.258-1H3a2 2 0 0 0-2-2V3a2 2 0 0 0 2-2h10a2 2 0 0 0 2 2v3.528c.38.34.717.728 1 1.154V1a1 1 0 0 0-1-1z"/>
                            <path d="M9.998 5.083 10 5a2 2 0 1 0-3.132 1.65 6 6 0 0 1 3.13-1.567"/>
                        </svg>
                        <div>Carteira</div> 
                    </a>
                </div>
                <div class="icon-container" >
                    <a href="#" style="text-decoration: none; color: black;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="auto" fill="currentColor" class="bi bi-box-arrow-left" viewBox="0 0 16 16" style="padding-top: 10px;" >
                            <path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0z"/>
                            <path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708z"/>
                        </svg>
                        <div  style="margin-bottom: 10%;">Log-out</div> 
                    </a>
                </div>
            </div>
        </div>
    </nav>
    <div id="welcome"></div>
    <div class="container">
        <!-- Eventos disponíveis -->
        <div class="event-section">
          <h2>Eventos Disponíveis</h2>
          <div class="events" id="events">
           
          </div>
        </div>
    
        <!-- Eventos mais apostados -->
        <div class="event-section">
          <br>
          <h2>Eventos Mais Apostados</h2>
          <div class="events" id="eventos-apostados">
           
          </div>
        </div>
    
        <!-- Eventos por categoria -->
        <div class="event-section">
          <br>
          <h2>Eventos por Categoria</h2>
          <div class="category-dropdown">
            <select>
              <option value="categoria1">Categoria 1</option>
              <option value="categoria2">Categoria 2</option>
            </select>
          </div>
          <br>
          <div class="events">
            <div class="event-card">
              <h3>Título</h3>
              <div class="data-evento">data/evento</div>
              <p class="descricao">descrição</p>
              <p class="valor">valor cota</p>
              <p class="data-fim">data-fim</p>
              <button>Apostar</button>
            </div>
            <div class="event-card">
              <h3>Título</h3>
              <div class="data-evento">data/evento</div>
              <p class="descricao">descrição</p>
              <p class="valor">valor cota</p>
              <p class="data-fim">data-fim</p>
              <button>Apostar</button>
            </div>
          </div>
        </div>
      </div>
<script>

        var eventsContainer = document.getElementById('events');
        var eventsContainerMaisApostados = document.getElementById('eventos-apostados');
    
        // Função para buscar eventos disponíveis
        document.addEventListener("DOMContentLoaded", async () => {
            try {
                const reqHeaders = new Headers();
                reqHeaders.append("Content-Type", "application/json");
                reqHeaders.append("connection", "keep-alive");
            const res = await fetch("http://localhost:5000/check-session", {
            method: "GET",
            headers: reqHeaders,
            credentials: "include", // Inclui cookies na requisição
        });

        if (res.ok) {
            const data = await res.json();
            document.getElementById("welcome").innerText = `Bem-vindo(a), ${data.user.email}!`;
        } else {
            // Redirecionar para login se não autenticado
            //window.location.href = "../login/login.html";
            console.log(res);
        }
    } catch (error) {
        console.error("Erro ao verificar sessão:", error);
    }
});

        async function requestAvailableEvents() {
            try {
                const resEvent = await fetch("http://localhost:5000/availableEvents", {
                    method: "GET"
                });
                if (resEvent.ok) {
                    const eventsData = await resEvent.json();
                    fillAvailableEventCards(eventsData);
                } else {
                    alert("Nenhum evento encontrado.");
                }
            } catch (error) {
                console.error("Erro ao buscar eventos disponíveis:", error);
            }
        }
    
        // Função para preencher os cartões de eventos disponíveis
        function fillAvailableEventCards(events) {
            eventsContainer.innerHTML = ''; // Limpa os eventos existentes
            events.forEach(event => {
                const eventCard = `
                    <div class="event-card">
                        <h3>${event.TITULO}</h3>
                        <div class="data-evento">Data: ${event.DATA_EVENTO}</div>
                        <p class="descricao">${event.DESCRICAO}</p>
                        <p class="valor">Valor da cota: ${event.VALOR_COTA}</p>
                        <p class="data-fim">Data e hora final: ${event.DATA_HORA_FIM}</p>
                        <button>Apostar</button>
                    </div>
                `;
                eventsContainer.insertAdjacentHTML('beforeend', eventCard);
            });
        }
    
        // Função para buscar eventos mais apostados
        async function requestEventosMaisApostados() {
            try {
                const resEvent = await fetch("http://localhost:5000/eventosMaisApostados", {
                    method: "GET"
                });
                if (resEvent.ok) {
                    const eventsData = await resEvent.json();
                    fillMostBetEventCards(eventsData);
                } else {
                    alert("Nenhum evento mais apostado encontrado.");
                }
            } catch (error) {
                console.error("Erro ao buscar eventos mais apostados:", error);
            }
        }
    
        // Função para preencher os cartões de eventos mais apostados
        function fillMostBetEventCards(events) {
            eventsContainerMaisApostados.innerHTML = ''; // Limpa os eventos existentes
            events.forEach(event => {
                const eventCard = `
                    <div class="event-card">
                        <h3>${event.TITULO}</h3>
                        <div class="data-evento">Data: ${event.DATA_EVENTO}</div>
                        <p class="descricao">${event.DESCRICAO}</p>
                        <p class="valor">Valor da cota: ${event.VALOR_COTA}</p>
                        <p class="data-fim">Data e hora final: ${event.DATA_HORA_FIM}</p>
                        <button>Apostar</button>
                    </div>
                `;
                eventsContainerMaisApostados.insertAdjacentHTML('beforeend', eventCard);
            });
        }
    
        // Executa as funções ao carregar o DOM
        document.addEventListener('DOMContentLoaded', () => {
            requestAvailableEvents();
            requestEventosMaisApostados();
        });
</script>

</body>
</html>